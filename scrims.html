<!DOCTYPE html>
<html>

<head>
    <meta http-equiv='cache-control' content='no-cache'>
    <meta http-equiv='expires' content='0'>
    <meta http-equiv='pragma' content='no-cache'>
    <title>Scrims-v2</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <script src="dat.gui.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sprintf/1.1.1/sprintf.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/91/three.js"></script>
    <style>
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track-piece {
            background-color: transparent;
        }

        ::-webkit-scrollbar-corner {
            background-color: transparent;
        }

        .dg {
            font-family: Monaco, sans-serif;
            font-size: 8pt;
        }
    </style>
    <script defer src="global-menu.js"></script>
</head>

<body style="background:black;">
    <script>
        try {
            var fs = require("fs");
            var __dirname = fs.realpathSync.native(".");
        } catch (e) {
            console.log(e);
        }
    </script>
    <script src='CsoundAC.js'></script>
    <script src="CsoundAudioNode.js"></script>
    <script src="csoundloader.js"></script>
    <div id='webgl_cell' class='canvas' style="width:98vw;height:98vh;" />
    <table id='statistics'
        style="table-layout:fixed;position:absolute;left:1vw;color:#eee;top:1vw;font-family:Monaco, sans-serif;font-size:8pt;">
        <col width=600px>
        <col width=208px>
        <tr style="color:gold;">
            <!-- Copyright (C) 2016-2020 by Michael Gogins -->
            <td><b><i>Scrims v2</i></b>, for Csound+HTML5</td>
            <td style="text-align:right;">Michael Gogins</td>
        </tr>
        <tr>
            <td>Time:</td>
            <td id="Time_cell" style="text-align:right;color:LawnGreen;font-weight:bold;">0</td>
        </tr>
        <tr>
        <tr>
            <td>Subset: </td>
            <td id="Subset_cell" style="color:SkyBlue;text-align:right;"></td>
        </tr>
        <tr>
            <td>Point: </td>
            <td id="Point_cell" style="color:SkyBlue;text-align:right;"></td>
        </tr>
        <tr>
            <td>X: </td>
            <td id="X_cell" style="color:SkyBlue;text-align:right;"></td>
        </tr>
        <tr>
            <td>Y: </td>
            <td id="Y_cell" style="color:SkyBlue;text-align:right;"></td>
        </tr>
        <tr>
            <td>Chord: </td>
            <td id="Chord_cell" style="color:SkyBlue;text-align:right;"></td>
        </tr>
        <tr>
            <td>Notes: </td>
            <td id="Notes_cell" style="color:SkyBlue;text-align:right;"></td>
        </tr>
        <tr id='messages'>
            <td colspan="2"><textarea id="console"
                    style="width:100%;color:SkyBlue;background-color:transparent;border:none;text-align:left;height:200px;overflow:auto;padding:0;margin:0;border-collapse:collapse;font-family:Courier, sans-serif;font-size:9pt;"></textarea>
            </td>
        </tr>
    </table>
    <textarea class="code" id="csd" hidden rows=24 cols=80>
<CsoundSynthesizer>
<CsOptions>
-d -f -m195 -odac
</CsOptions>
<CsInstruments>

sr = 48000
ksmps = 128
nchnls = 2
0dbfs = 15

connect "BarModel", "outleft", "ReverbSC", "inleft"
connect "BarModel", "outright", "ReverbSC", "inright"
connect "Blower", "outleft", "ReverbSC", "inleft"
connect "Blower", "outright", "ReverbSC", "inright"
connect "Bower", "outleft", "ReverbSC", "inleft"
connect "Bower", "outright", "ReverbSC", "inright"
connect "Buzzer", "outleft", "ReverbSC", "inleft"
connect "Buzzer", "outright", "ReverbSC", "inright"
connect "Droner", "outleft", "ReverbSC", "inleft"
connect "Droner", "outright", "ReverbSC", "inright"
connect "FMModerate2", "outleft", "ReverbSC", "inleft"
connect "FMModerate2", "outright", "ReverbSC", "inright"
connect "Harpsichord", "outleft", "ReverbSC", "inleft"
connect "Harpsichord", "outright", "ReverbSC", "inright"
connect "KarplusStrong3", "outleft", "ReverbSC", "inleft"
connect "KarplusStrong3", "outright", "ReverbSC", "inright"
connect "Phaser", "outleft", "ReverbSC", "inleft"
connect "Phaser", "outleft", "ReverbSC", "inright"
connect "Plucked", "outright", "ReverbSC", "inleft"
connect "Plucked", "outleft", "ReverbSC", "inright"
connect "Rhodes", "outleft", "ReverbSC", "inleft"
connect "Rhodes", "outright", "ReverbSC", "inright"
connect "Sweeper", "outleft", "ReverbSC", "inleft"
connect "Sweeper", "outright", "ReverbSC", "inright"
connect "Shiner", "outleft", "ReverbSC", "inleft"
connect "Shiner", "outright", "ReverbSC", "inright"
connect "Xing", "outleft", "MasterOutput", "inleft"
connect "Xing", "outright", "MasterOutput", "inright"
connect "YiString", "outleft", "ReverbSC", "inleft"
connect "YiString", "outright", "ReverbSC", "inright"
;connect "YiString", "chorusleft", "SolinaChorus", "inleft"
;connect "YiString", "chorusright", "SolinaChorus", "inright"
;connect "SolinaChorus", "outleft", "ReverbSC", "inleft"
;connect "SolinaChorus", "outright", "ReverbSC", "inright"
connect "ReverbSC", "outleft", "MasterOutput", "inleft"
connect "ReverbSC", "outright", "MasterOutput", "inright"

;alwayson "Controls"
;alwayson "SolinaChorus"
;alwayson "ReverbSC"
;alwayson "MasterOutput"

scoreline_i "i \"Controls\" 0 36000"
;scoreline_i "i \"SolinaChorus\" 0 36000"
scoreline_i "i \"ReverbSC\" 0 36000"
scoreline_i "i \"MasterOutput\" 0 36000"

scoreline_i "f 0 3600\n"

gk_Plucked_level init 0
instr Plucked
; Author: Michael Gogins
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_velocity = p5
k_space_front_to_back = p6
k_space_left_to_right = p7
k_space_bottom_to_top = p8
i_phase = p9
i_frequency = cpsmidinn(i_midi_key)
; Adjust the following value until "overall amps" at the end of performance is about -6 dB.
i_overall_amps = 101
i_normalization = ampdb(-i_overall_amps) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
k_gain = ampdb(gk_Plucked_level)
isine ftgenonce 0, 0, 65537, 10, 1
aenvelope transeg 1.0, 20, -12.0, 0.05
aexcite poscil 1.0, 1, isine
asignal1 wgpluck2 0.1, 1.0, i_frequency, 0.25, 0.22
asignal2 wgpluck2 0.1, 1.0, i_frequency * 1.003, 0.20, 0.223
asignal3 wgpluck2 0.1, 11, i_frequency * 0.997, 0.23, 0.224
a_signal = (asignal1 + asignal2 + asignal3) * aenvelope
i_attack = .002
i_sustain = p3
i_release = 0.01
xtratim i_attack + i_release
a_declicking linsegr 0, i_attack, 1, i_sustain, 1, i_release, 0
a_signal = a_signal * i_amplitude * a_declicking * k_gain
#ifdef USE_SPATIALIZATION
a_spatial_reverb_send init 0
a_bsignal[] init 16
a_bsignal, a_spatial_reverb_send Spatialize a_signal, k_space_front_to_back, k_space_left_to_right, k_space_bottom_to_top
outletv "outbformat", a_bsignal
outleta "out", a_spatial_reverb_send
#else
a_out_left, a_out_right pan2 a_signal, k_space_left_to_right
outleta "outleft", a_out_left
outleta "outright", a_out_right
#endif
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_Rhodes_level init 0
gi_Rhodes_sine ftgen 0, 0, 65537, 10, 1
gi_Rhodes_cosine ftgen 0, 0, 65537, 11, 1
gi_Rhodes_blank ftgen 0, 0, 65537, 10, 0 ; Blank wavetable for some Cook FM opcodes.
instr Rhodes
; Authors: Perry Cook, John ffitch, Michael Gogins
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_velocity = p5
k_space_front_to_back = p6
k_space_left_to_right = .5
k_space_bottom_to_top = p8
i_phase = p9
i_frequency = cpsmidinn(i_midi_key)
; Adjust the following value until "overall amps" at the end of performance is about -6 dB.
i_overall_amps = 82
i_normalization = ampdb(-i_overall_amps) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
k_gain = ampdb(gk_Rhodes_level)
iindex = 4
icrossfade = 3
ivibedepth = 0.2
iviberate = 6
ifn1 = gi_Rhodes_sine
ifn2 = gi_Rhodes_cosine
ifn3 = gi_Rhodes_sine
ifn4 = gi_Rhodes_blank
ivibefn = gi_Rhodes_sine
a_signal fmrhode i_amplitude, i_frequency, iindex, icrossfade, ivibedepth, iviberate, ifn1, ifn2, ifn3, ifn4, ivibefn
i_attack = .002
i_sustain = p3
i_release = 0.01
xtratim i_attack + i_release
a_declicking linsegr 0, i_attack, 1, i_sustain, 1, i_release, 0
a_signal = a_signal * a_declicking * k_gain
#ifdef USE_SPATIALIZATION
a_spatial_reverb_send init 0
a_bsignal[] init 16
a_bsignal, a_spatial_reverb_send Spatialize a_signal, k_space_front_to_back, k_space_left_to_right, k_space_bottom_to_top
outletv "outbformat", a_bsignal
outleta "out", a_spatial_reverb_send
#else
a_out_left, a_out_right pan2 a_signal, k_space_left_to_right
outleta "outleft", a_out_left
outleta "outright", a_out_right
#endif
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_Buzzer_attack init .125
gk_Buzzer_release init .25
gk_Buzzer_harmonics init 8
gk_Buzzer_level init 0
gk_Buzzer_midi_dynamic_range init 127
gi_Buzzer_sine ftgen 0, 0, 65537, 10, 1
instr Buzzer
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_dynamic_range = i(gk_Buzzer_midi_dynamic_range)
i_midi_velocity = p5 * i_midi_dynamic_range / 127 + (63.5 - i_midi_dynamic_range / 2)
k_space_front_to_back = p6
k_space_left_to_right = p7
k_space_bottom_to_top = p8
i_phase = p9
i_frequency = cpsmidinn(i_midi_key)
; Adjust the following value until "overall amps" at the end of performance is about -6 dB.
i_level_correction = 79.5
i_normalization = ampdb(-i_level_correction) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
k_gain = ampdb(gk_Buzzer_level)
i_attack = i(gk_Buzzer_attack)
i_release = i(gk_Buzzer_release)
i_sustain = p3
xtratim i_attack + i_release
a_envelope transegr 0.0, i_attack / 2.0, 1.5, i_amplitude / 2.0, i_attack / 2.0, -1.5, i_amplitude, i_sustain, 0.0, i_amplitude, i_release / 2.0, 1.5, i_amplitude / 2.0, i_release / 2.0, -1.5, 0
a_signal buzz a_envelope, i_frequency, gk_Buzzer_harmonics, gi_Buzzer_sine

a_signal = a_signal * k_gain
#ifdef USE_SPATIALIZATION
a_spatial_reverb_send init 0
a_bsignal[] init 16
a_bsignal, a_spatial_reverb_send Spatialize a_signal, k_space_front_to_back, k_space_left_to_right, k_space_bottom_to_top
outletv "outbformat", a_bsignal
outleta "out", a_spatial_reverb_send
#else
a_out_left, a_out_right pan2 a_signal, k_space_left_to_right
outleta "outleft", a_out_left
outleta "outright", a_out_right
#endif
;printks "Buzzer         i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d l%9.4f r%9.4f\n", 1, p1, p2, p3, p4, p5, p7, active(p1), dbamp(rms(a_out_left)), dbamp(rms(a_out_right))
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_Droner_partial1 init .5
gk_Droner_partial2 init .05
gk_Droner_partial3 init .1
gk_Droner_partial4 init .2
gk_Droner_partial5 init .1
gk_Droner_partial6 init 0
gk_Droner_partial7 init 0
gk_Droner_partial8 init 0
gk_Droner_partial9 init 0
gk_Droner_partial10 init 0
gk_Droner_level init 0
gi_Droner_waveform init 0
instr Droner
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_velocity = p5
k_space_front_to_back = p6
k_space_left_to_right = p7
k_space_bottom_to_top = p8
i_phase = p9
i_frequency = cpsmidinn(i_midi_key)
; Adjust the following value until "overall amps" at the end of performance is about -6 dB.
i_overall_amps = -20 + 98 + 4
i_normalization = ampdb(-i_overall_amps) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
k_gain = ampdb(gk_Droner_level)
k1 = gk_Droner_partial1
k2 = gk_Droner_partial2
k3 = gk_Droner_partial3
k4 = gk_Droner_partial4
k5 = gk_Droner_partial5
k6 = gk_Droner_partial6
k7 = gk_Droner_partial7
k8 = gk_Droner_partial8
k9 = gk_Droner_partial9
k10 = gk_Droner_partial10
iwaveform = gi_Droner_waveform
iattack = .5
idecay = .5
xtratim iattack + idecay
isustain = p3
aenvelope transegr 0.0, iattack / 2.0, 1.5, 1 / 2.0, iattack / 2.0, -1.5, 1, isustain, 0.0, 1, idecay / 2.0, 1.5, 1 / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(i_midi_key)
isine ftgenonce 0, 0, 65537, 10, 1, 0, .02
if iwaveform == 0 goto i_waveform_0
if iwaveform == 1 goto i_waveform_1
if iwaveform == 2 goto i_waveform_2
i_waveform_0:
asignal poscil3 1, ihertz, isine
goto i_waveform_endif
i_waveform_1:
asignal vco2 1, ihertz, 8 ; integrated saw
goto i_waveform_endif
i_waveform_2:
asignal vco2 1, ihertz, 12 ; triangle
i_waveform_endif:
asignal chebyshevpoly asignal, 0, k1, k2, k3, k4, k5, k6, k7, k8, k9, k10
adeclicking linsegr 0, .004, 1, p3 - .014, 1, .1, 0
a_signal = asignal * adeclicking
a_signal = a_signal * i_amplitude * k_gain * 1.4
#ifdef USE_SPATIALIZATION
a_spatial_reverb_send init 0
a_bsignal[] init 16
a_bsignal, a_spatial_reverb_send Spatialize a_signal, k_space_front_to_back, k_space_left_to_right, k_space_bottom_to_top
outletv "outbformat", a_bsignal
outleta "out", a_spatial_reverb_send
#else
a_out_left, a_out_right pan2 a_signal, k_space_left_to_right
outleta "outleft", a_out_left
outleta "outright", a_out_right
#endif
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_YiString_midi_dynamic_range init 127
gk_YiString_level init 0
gk_YiString_reverb_send init .5
gk_YiString_chorus_send init .5
gi_YiString_overlap init .1
instr YiString
//////////////////////////////////////////////
// Original by Steven Yi.
// Adapted by Michael Gogins.
//////////////////////////////////////////////
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_dynamic_range = i(gk_YiString_midi_dynamic_range)
i_midi_velocity = p5 * i_midi_dynamic_range / 127 + (63.5 - i_midi_dynamic_range / 2)
k_space_front_to_back = p6
k_space_left_to_right = p7
k_space_bottom_to_top = p8
i_phase = p9
i_frequency = cpsmidinn(i_midi_key)
; Adjust the following value until "overall amps" at the end of performance is about -6 dB.
i_level_correction = 71.5
i_normalization = ampdb(-i_level_correction) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
k_gain = ampdb(gk_YiString_level)
iattack = gi_YiString_overlap
isustain = p3
idecay = gi_YiString_overlap
xtratim iattack + idecay
aenvelope transeg 0.0, iattack / 2.0, 1.5, i_amplitude / 2.0, iattack / 2.0, -1.5, i_amplitude, isustain, 0.0, i_amplitude, idecay / 2.0, 1.5, i_amplitude / 2.0, idecay / 2.0, -1.5, 0
;ampenv = madsr:a(1, 0.1, 0.95, 0.5)
asignal = vco2(1, i_frequency)
asignal = moogladder(asignal, 6000, 0.1)
a_signal = asignal * aenvelope
i_attack = .002
i_release = 0.01
i_sustain = p3 - (i_attack + i_release)
a_declicking linsegr 0, i_attack, 1, i_sustain, 1, i_release, 0
a_signal = a_signal * i_amplitude * a_declicking * k_gain 
#ifdef USE_SPATIALIZATION
a_spatial_reverb_send init 0
a_bsignal[] init 16
a_bsignal, a_spatial_reverb_send Spatialize a_signal, k_space_front_to_back, k_space_left_to_right, k_space_bottom_to_top
outletv "outbformat", a_bsignal
outleta "out", a_spatial_reverb_send
#else
a_signal_reverb = a_signal * gk_YiString_reverb_send
a_signal_chorus = a_signal * gk_YiString_chorus_send
a_out_left, a_out_right pan2 a_signal_reverb, p7
outleta "outleft", a_out_left
outleta "outright",  a_out_right
a_out_left, a_out_right pan2 a_signal_chorus, p7
outleta "chorusleft", a_out_left 
outleta "chorusright", a_out_right 
;printks "YiString         %9.4f  %9.4f\n", 0.5, a_out_left, a_out_right
#endif
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_FMModerate2_level init 0
gi_FMModerate2_carrier init 1
gi_FMModerate2_modulator init 4
gi_FMModerate2_fmamplitude init 9
gi_FMModerate2_index init 2
instr FMModerate2
; Author: Michael Gogins
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_velocity = p5
k_space_front_to_back = p6
k_space_left_to_right = p7
k_space_bottom_to_top = p8
i_phase = p9
i_overall_amps = 85
i_normalization = ampdb(-i_overall_amps) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
i_frequency = cpsmidinn(i_midi_key)
k_gain = ampdb(gk_FMModerate2_level)
iattack = 0.002
isustain = p3
idecay = 1.5
irelease = 0.05
xtratim iattack + irelease
icarrier = gi_FMModerate2_carrier
imodulator = gi_FMModerate2_modulator
ifmamplitude = gi_FMModerate2_fmamplitude
index = gi_FMModerate2_index
ifrequencyb = i_frequency * 1.003
icarrierb = icarrier * 1.004
aindenv transegr 0.0, iattack, -8.0, 1.0, idecay, -8.0, 0.025, isustain, 0.0, 0.025, irelease, 7.0, 0.0
aindex = aindenv * index * ifmamplitude
icosine ftgenonce 0, 0, 65537, 11, 1
aouta foscili 1.0, i_frequency, icarrier, imodulator, index, icosine
aoutb foscili 1.0, ifrequencyb, icarrierb, imodulator, index, icosine; Plus amplitude correction.
a_signal = (aouta + aoutb) * aindenv
i_attack = .002
i_sustain = p3
i_release = 0.01
xtratim i_attack + i_sustain + i_release
a_declicking linsegr 0, i_attack, 1, i_sustain, 1, i_release, 0
a_signal = a_signal * i_amplitude * a_declicking * k_gain
#ifdef USE_SPATIALIZATION
a_spatial_reverb_send init 0
a_bsignal[] init 16
a_bsignal, a_spatial_reverb_send Spatialize a_signal, k_space_front_to_back, k_space_left_to_right, k_space_bottom_to_top
outletv "outbformat", a_bsignal
outleta "out", a_spatial_reverb_send
#else
a_out_left, a_out_right pan2 a_signal, k_space_left_to_right
outleta "outleft", a_out_left
outleta "outright", a_out_right
#endif
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_Phaser_attack init .125
gk_Phaser_release init .125
gk_Phaser_ratio1 init 1
gk_Phaser_ratio2 init 1/3
gk_Phaser_index1 init 2
gk_Phaser_index2 init 0.0125
gk_Phaser_level init 0.5
gk_Phaser_midi_dynamic_range init 127
gi_Phaser_sine ftgen 0,0,65537,10,1
instr Phaser
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_dynamic_range = i(gk_Phaser_midi_dynamic_range)
i_midi_velocity = p5 * i_midi_dynamic_range / 127 + (63.5 - i_midi_dynamic_range / 2)
k_space_front_to_back = p6
k_space_left_to_right = p7
k_space_bottom_to_top = p8
i_phase = p9
i_frequency = cpsmidinn(i_midi_key)
; Adjust the following value until "overall amps" at the end of performance is about -6 dB.
i_level_correction = 85.5
i_normalization = ampdb(-i_level_correction) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
k_gain = ampdb(gk_Phaser_level)
i_attack = i(gk_Phaser_attack)
i_release = i(gk_Phaser_release)
i_sustain = 1000
xtratim i_attack + i_release
a_envelope transegr 0.0, i_attack / 2.0, 1.5, i_amplitude / 2.0, i_attack / 2.0, -1.5, i_amplitude, i_sustain, 0.0, i_amplitude, i_release / 2.0, 1.5, i_amplitude / 2.0, i_release / 2.0, -1.5, 0
a1,a2 crosspm gk_Phaser_ratio1, gk_Phaser_ratio2, gk_Phaser_index1, gk_Phaser_index2, i_frequency, gi_Phaser_sine, gi_Phaser_sine
a_signal = (a1 + a2) * k_gain * a_envelope
#ifdef USE_SPATIALIZATION
a_spatial_reverb_send init 0
a_bsignal[] init 16
a_bsignal, a_spatial_reverb_send Spatialize a_signal, k_space_front_to_back, k_space_left_to_right, k_space_bottom_to_top
outletv "outbformat", a_bsignal
outleta "out", a_spatial_reverb_send
#else
a_out_left, a_out_right pan2 a_signal, k_space_left_to_right
outleta "outleft", a_out_left
outleta "outright", a_out_right
#endif
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
;printks "Phaser         i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d l%9.4f r%9.4f\n", 1, p1, p2, p3, p4, p5, p7, active(p1), dbamp(rms(aleft)), dbamp(rms(aright))
endin

gk_Bower_midi_dynamic_range init 127
gk_Bower_attack init .125
gk_Bower_release init .125
gk_Bower_level init 0
gk_Bower_pressure init 0.25
gi_Bower_sine ftgen 0,0,65537,10,1
instr Bower
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_dynamic_range = i(gk_Bower_midi_dynamic_range)
i_midi_velocity = p5 * i_midi_dynamic_range / 127 + (63.5 - i_midi_dynamic_range / 2)
k_space_front_to_back = p6
k_space_left_to_right = p7
k_space_bottom_to_top = p8
i_phase = p9
i_frequency = cpsmidinn(i_midi_key)
; Adjust the following value until "overall amps" at the end of performance is about -6 dB.
i_level_correction = 80
i_normalization = ampdb(-i_level_correction) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
k_gain = ampdb(gk_Bower_level)
iattack = i(gk_Bower_attack)
idecay = i(gk_Bower_release)
isustain = p3
iamp = i_amplitude
xtratim iattack + idecay
kenvelope transegr 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(i_midi_key)
kamp = kenvelope
kfreq = ihertz
kpres = 0.25
krat rspline 0.006,0.988,1,4
kvibf = 4.5
kvibamp = 0
iminfreq = i(kfreq) / 2
aSig wgbow kamp,kfreq,gk_Bower_pressure,krat,kvibf,kvibamp,gi_Bower_sine,iminfreq
a_signal = aSig * kenvelope * k_gain
aleft, aright pan2 a_signal, k_space_left_to_right
outleta "outleft", aleft
outleta "outright", aright
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_Blower_grainDensity init 40
gk_Blower_grainDuration init 0.2
gk_Blower_grainAmplitudeRange init 100
gk_Blower_grainFrequencyRange init 3
gk_Blower_level init 0
gk_Blower_midi_dynamic_range init 127
gi_Blower_grtab ftgen 0, 0, 65537, 10, 1, .3, .1, 0, .2, .02, 0, .1, .04
gi_Blower_wintab ftgen 0, 0, 65537, 10, 1, 0, .5, 0, .33, 0, .25, 0, .2, 0, .167
instr Blower
//////////////////////////////////////////////
// Original by Hans Mikelson.
// Adapted by Michael Gogins.
//////////////////////////////////////////////
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_dynamic_range = i(gk_Blower_midi_dynamic_range)
i_midi_velocity = p5 * i_midi_dynamic_range / 127 + (63.5 - i_midi_dynamic_range / 2)
k_space_front_to_back = p6
k_space_left_to_right = p7
k_space_bottom_to_top = p8
i_phase = p9
i_frequency = cpsmidinn(i_midi_key)
; Adjust the following value until "overall amps" at the end of performance is about -6 dB.
i_level_correction = 132
i_normalization = ampdb(-i_level_correction) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
k_gain = ampdb(gk_Blower_level)
iHz = i_frequency
ihertz = iHz
ip4 = i_amplitude
ip5 = iHz
ip6 = gi_Blower_grtab
ip7 = gi_Blower_wintab
ip8 = 0.033
ip8 = .002
ip9 = 150
ip9 = 100
ip10 = 1.6
ip10 = 3
idur = p3
iamp = i_amplitude ; p4
ifqc = iHz ; cpspch(p5)
igrtab = ip6
iwintab = ip7
ifrng = ip8
idens = ip9
ifade = ip10
igdur = 0.2
iattack = 0.5
i_sustain = p3
idecay = 1.5
xtratim iattack + idecay
kenvelope transegr 0.0, iattack / 2.0, 1.5, .5, iattack / 2.0, -1.5, 1, i_sustain, 0.0, 1, idecay / 2.0, 1.5, .5, idecay / 2.0, -1.5, 0
; kamp linseg 0, ifade, 1, idur - 2 * ifade, 1, ifade, 0
kamp = kenvelope
; Amp Fqc Dense AmpOff PitchOff GrDur GrTable WinTable MaxGrDur
aoutl grain ip4, ifqc, gk_Blower_grainDensity, gk_Blower_grainAmplitudeRange, gk_Blower_grainFrequencyRange, gk_Blower_grainDuration, igrtab, iwintab, 5
aoutr grain ip4, ifqc, gk_Blower_grainDensity, gk_Blower_grainAmplitudeRange, gk_Blower_grainFrequencyRange, gk_Blower_grainDuration, igrtab, iwintab, 5
a_signal = aoutl + aoutr
i_attack = .002
i_release = 0.01
xtratim i_attack + i_release
a_declicking linsegr 0, i_attack, 1, i_sustain, 1, i_release, 0
a_signal = a_signal * i_amplitude * a_declicking * k_gain
#ifdef USE_SPATIALIZATION
a_spatial_reverb_send init 0
a_bsignal[] init 16
a_bsignal, a_spatial_reverb_send Spatialize a_signal, k_space_front_to_back, k_space_left_to_right, k_space_bottom_to_top
outletv "outbformat", a_bsignal
outleta "out", a_spatial_reverb_send
#else
a_out_left, a_out_right pan2 a_signal, k_space_left_to_right
outleta "outleft", a_out_left
outleta "outright", a_out_right
#endif
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_Xing_level init 0
instr Xing
; Author: Andrew Horner
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_velocity = p5
k_space_front_to_back = p6
k_space_left_to_right = p7
k_space_bottom_to_top = p8
i_phase = p9
i_overall_amps = 75
i_normalization = ampdb(-i_overall_amps) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
i_frequency = cpsmidinn(i_midi_key)
k_gain = ampdb(gk_Xing_level  )
isine ftgenonce 0, 0, 65537, 10, 1
iinstrument = p1
istarttime = p2
ioctave = p4
idur = p3
kfreq = k(i_frequency)
iamp = 1
inorm = 32310
aamp1 linseg 0,.001,5200,.001,800,.001,3000,.0025,1100,.002,2800,.0015,1500,.001,2100,.011,1600,.03,1400,.95,700,1,320,1,180,1,90,1,40,1,20,1,12,1,6,1,3,1,0,1,0
adevamp1 linseg 0, .05, .3, idur - .05, 0
adev1 poscil adevamp1, 6.7, isine, .8
amp1 = aamp1 * (1 + adev1)
aamp2 linseg 0,.0009,22000,.0005,7300,.0009,11000,.0004,5500,.0006,15000,.0004,5500,.0008,2200,.055,7300,.02,8500,.38,5000,.5,300,.5,73,.5,5.,5,0,1,1
adevamp2 linseg 0,.12,.5,idur-.12,0
adev2 poscil adevamp2, 10.5, isine, 0
amp2 = aamp2 * (1 + adev2)
aamp3 linseg 0,.001,3000,.001,1000,.0017,12000,.0013,3700,.001,12500,.0018,3000,.0012,1200,.001,1400,.0017,6000,.0023,200,.001,3000,.001,1200,.0015,8000,.001,1800,.0015,6000,.08,1200,.2,200,.2,40,.2,10,.4,0,1,0
adevamp3 linseg 0, .02, .8, idur - .02, 0
adev3 poscil adevamp3, 70, isine ,0
amp3 = aamp3 * (1 + adev3)
awt1 poscil amp1, i_frequency, isine
awt2 poscil amp2, 2.7 * i_frequency, isine
awt3 poscil amp3, 4.95 * i_frequency, isine
asig = awt1 + awt2 + awt3
arel linenr 1,0, idur, .06
a_signal = asig * arel * (iamp / inorm)
i_attack = .002
i_sustain = p3
i_release = 0.01
xtratim i_attack + i_release
a_declicking linsegr 0, i_attack, 1, i_sustain, 1, i_release, 0
a_signal = a_signal * i_amplitude * a_declicking * k_gain
#ifdef USE_SPATIALIZATION
a_spatial_reverb_send init 0
a_bsignal[] init 16
a_bsignal, a_spatial_reverb_send Spatialize a_signal, k_space_front_to_back, k_space_left_to_right, k_space_bottom_to_top
outletv "outbformat", a_bsignal
outleta "out", a_spatial_reverb_send
#else
a_out_left, a_out_right pan2 a_signal, k_space_left_to_right
outleta "outleft", a_out_left
outleta "outright", a_out_right
#endif
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_Harpsichord_midi_dynamic_range init 127
gk_Harpsichord_level init 0
gk_Harpsichord_pick init .075
gk_Harpsichord_reflection init .5
gk_Harpsichord_pluck init .75
instr Harpsichord
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_dynamic_range = i(gk_Harpsichord_midi_dynamic_range)
i_midi_velocity = p5 * i_midi_dynamic_range / 127 + (63.6 - i_midi_dynamic_range / 2)
k_space_front_to_back = p6
k_space_left_to_right = p7
k_space_bottom_to_top = p8
i_phase = p9
i_frequency = cpsmidinn(i_midi_key)
; Adjust the following value until "overall amps" at the end of performance is about -6 dB.
i_level_correction = 82.4
i_normalization = ampdb(-i_level_correction) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
k_gain = ampdb(gk_Harpsichord_level)
iHz = cpsmidinn(i_midi_key)
kHz = k(iHz)
aenvelope transeg 1.0, 20.0, -10.0, 0.05
k_amplitude = 1
apluck pluck 1, kHz, iHz, 0, 1
iharptable ftgenonce 0, 0, 65536, 7, -1, 1024, 1, 1024, -1
aharp poscil 1, kHz, iharptable
aharp2 balance apluck, aharp
a_signal	= (apluck + aharp2)
i_attack = .002
i_sustain = p3
i_release = 0.01
xtratim i_attack + i_release
a_declicking linsegr 0, i_attack, 1, i_sustain, 1, i_release, 0
a_signal = a_signal * i_amplitude * a_declicking * k_gain
#ifdef USE_SPATIALIZATION
a_spatial_reverb_send init 0
a_bsignal[] init 16
a_bsignal, a_spatial_reverb_send Spatialize a_signal, k_space_front_to_back, k_space_left_to_right, k_space_bottom_to_top
outletv "outbformat", a_bsignal
outleta "out", a_spatial_reverb_send
#else
a_out_left, a_out_right pan2 a_signal, k_space_left_to_right
outleta "outleft", a_out_left
outleta "outright", a_out_right
#endif
;printks "Harpsichord      %9.4f   %9.4f\n", 0.5, a_out_left, a_out_right
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_Bower_midi_dynamic_range init 127
gk_Bower_attack init .125
gk_Bower_release init .125
gk_Bower_level init 0
gk_Bower_pressure init 0.25
gi_Bower_sine ftgen 0,0,65537,10,1
instr Bower
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_dynamic_range = i(gk_Bower_midi_dynamic_range)
i_midi_velocity = p5 * i_midi_dynamic_range / 127 + (63.5 - i_midi_dynamic_range / 2)
k_space_front_to_back = p6
k_space_left_to_right = p7
k_space_bottom_to_top = p8
i_phase = p9
i_frequency = cpsmidinn(i_midi_key)
; Adjust the following value until "overall amps" at the end of performance is about -6 dB.
i_level_correction = 80
i_normalization = ampdb(-i_level_correction) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
k_gain = ampdb(gk_Bower_level)
iattack = i(gk_Bower_attack)
idecay = i(gk_Bower_release)
isustain = p3
iamp = i_amplitude
xtratim iattack + idecay
kenvelope transegr 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(i_midi_key)
kamp = kenvelope
kfreq = ihertz
kpres = 0.25
krat rspline 0.006,0.988,1,4
kvibf = 4.5
kvibamp = 0
iminfreq = i(kfreq) / 2
aSig wgbow kamp,kfreq,gk_Bower_pressure,krat,kvibf,kvibamp,gi_Bower_sine,iminfreq
a_signal = aSig * kenvelope * k_gain
aleft, aright pan2 a_signal, k_space_left_to_right
outleta "outleft", aleft
outleta "outright", aright
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_Sweeper_midi_dynamic_range init 127
gk_Sweeper_attack init .125
gk_Sweeper_release init .25
gk_Sweeper_britel init 0.1
gk_Sweeper_briteh init 2.9
gk_Sweeper_britels init 2
gk_Sweeper_britehs init 1
gk_Sweeper_level init 0
gi_Sweeper_sine ftgen 0, 0, 65537, 10, 1
gi_Sweeper_octfn ftgen 0, 0, 65537, -19, 1, 0.5, 270, 0.5
instr Sweeper
//////////////////////////////////////////////
// Original by Iain McCurdy.
// Adapted by Michael Gogins.
//////////////////////////////////////////////
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_dynamic_range = i(gk_Sweeper_midi_dynamic_range)
i_midi_velocity = p5 * i_midi_dynamic_range / 127 + (63.5 - i_midi_dynamic_range / 2)
k_space_front_to_back = p6
k_space_left_to_right = p7
k_space_bottom_to_top = p8
i_phase = p9
i_frequency = cpsmidinn(i_midi_key)
; Adjust the following value until "overall amps" at the end of performance is about -6 dB.
i_level_correction = 78.3
i_normalization = ampdb(-i_level_correction) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
k_gain = ampdb(gk_Sweeper_level)

iattack = i(gk_Sweeper_attack)
irelease = i(gk_Sweeper_release)
isustain = p3
xtratim iattack + irelease
kenvelope transegr 0.0, iattack / 2.0, 1.5, i_amplitude / 2.0, iattack / 2.0, -1.5, i_amplitude, isustain, 0.0, i_amplitude, irelease / 2.0, 1.5, i_amplitude / 2.0, irelease / 2.0, -1.5, 0
ihertz = i_frequency
icps = ihertz
kamp expseg 0.001,0.02,0.2,p3-0.01,0.001
ktonemoddep jspline 0.01,0.05,0.2
ktonemodrte jspline 6,0.1,0.2
ktone poscil3 ktonemoddep, ktonemodrte, gi_Sweeper_sine
kbrite rspline gk_Sweeper_britel, gk_Sweeper_briteh, gk_Sweeper_britels, gk_Sweeper_britehs
ibasfreq init icps
ioctcnt init 3
iphs init 0
a1 hsboscil kenvelope, ktone, kbrite, ibasfreq, gi_Sweeper_sine, gi_Sweeper_octfn, ioctcnt, iphs
amod poscil3 0.25, ibasfreq*(1/3), gi_Sweeper_sine
arm = a1*amod
kmix expseg 0.001, 0.01, rnd(1), rnd(3)+0.3, 0.001
kmix=.25
a1 ntrpol a1, arm, kmix
kpanrte jspline 5, 0.05, 0.1
kpandep jspline 0.9, 0.2, 0.4
kpan poscil3 kpandep, kpanrte, gi_Sweeper_sine
;a1,a2 pan2 a1, kpan
a1,a2 pan2 a1, k_space_left_to_right
aleft delay a1, rnd(0.1)
aright delay a2, rnd(0.11)
a_signal = (aleft + aright) * k_gain
#ifdef USE_SPATIALIZATION
a_spatial_reverb_send init 0
a_bsignal[] init 16
a_bsignal, a_spatial_reverb_send Spatialize a_signal, k_space_front_to_back, k_space_left_to_right, k_space_bottom_to_top
outletv "outbformat", a_bsignal
outleta "out", a_spatial_reverb_send
#else
a_out_left, a_out_right pan2 a_signal, k_space_left_to_right
outleta "outleft", a_out_left
outleta "outright", a_out_right
#endif
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_Shiner_midi_dynamic_range init 127
gk_Shiner_attack init .0125
gk_Shiner_release init .0125
gk_Shiner_level init 0.5
instr Shiner
i_instrument = p1
i_time = p2
i_duration = p3
i_midi_key = p4
i_midi_dynamic_range = i(gk_Shiner_midi_dynamic_range)
i_midi_velocity = p5 * i_midi_dynamic_range / 127 + (63.5 - i_midi_dynamic_range / 2)
k_space_front_to_back = p6
k_space_left_to_right = p7
k_space_bottom_to_top = p8
i_phase = p9
i_frequency = cpsmidinn(i_midi_key)
; Adjust the following value until "overall amps" at the end of performance is about -6 dB.
i_level_correction = 92
i_normalization = ampdb(-i_level_correction) / 2
i_amplitude = ampdb(i_midi_velocity) * i_normalization
k_gain = ampdb(gk_Shiner_level)

iattack = i(gk_Shiner_attack)
idecay = i(gk_Shiner_release)
isustain = p3 - i(gk_Shiner_attack)
xtratim iattack + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, i_amplitude / 2.0, iattack / 2.0, -1.5, i_amplitude, isustain, 0.0, i_amplitude, idecay / 2.0, 1.5, i_amplitude / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(i_midi_key)
gk_Harmonics = 1 * 20
asignal vco2 kenvelope * 4, ihertz, 12
kgain = ampdb(gk_Shiner_level) * .5
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
a_signal = asignal * kgain * adamping
aleft, aright pan2 asignal, k_space_left_to_right
;printks2 "master gain:", kgain
outleta "outleft", aleft
outleta "outright", aright
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

/**
 * Solina Chorus, based on Solina String Ensemble Chorus Module

   J. Haible: Triple Chorus
   http://jhaible.com/legacy/triple_chorus/triple_chorus.html

   Hugo Portillo: Solina-V String Ensemble
   http://www.native-instruments.com/en/reaktor-community/reaktor-user-library/entry/show/4525/

   Parabola tabled shape borrowed from Iain McCurdy delayStereoChorus.csd:
   http://iainmccurdy.org/CsoundRealtimeExamples/Delays/delayStereoChorus.csd

   Author: Steven Yi
   Date: 2016.05.22
   Adapted by Michael Gogins
*/
gi_solina_parabola ftgen 0, 0, 65537, 19, 0.5, 1, 180, 1
; 3 sine wave LFOs, 120 degrees out of phase
opcode sol_lfo_3, aaa, kk
kfreq, kamp xin
aphs phasor kfreq
; Funny: Function syntax does not work in this context.
a0   tablei aphs, gi_solina_parabola, 1, 0, 1
a120 tablei aphs, gi_solina_parabola, 1, 0.333, 1
a240 tablei aphs, gi_solina_parabola, 1, -0.333, 1
xout (a0 * kamp), (a120 * kamp), (a240 * kamp)
endop

opcode solina_chorus, a, akkkk
aLeft, klfo_freq1, klfo_amp1, klfo_freq2, klfo_amp2 xin
imax = 100
;; slow lfo
as1, as2, as3 sol_lfo_3 klfo_freq1, klfo_amp1
;; fast lfo
af1, af2, af3  sol_lfo_3 klfo_freq2, klfo_amp2
at1 = limit(as1 + af1 + 5, 0.0, imax)
at2 = limit(as2 + af2 + 5, 0.0, imax)
at3 = limit(as3 + af3 + 5, 0.0, imax)
a1 vdelay3 aLeft, at1, imax
a2 vdelay3 aLeft, at2, imax
a3 vdelay3 aLeft, at2, imax
xout (a1 + a2 + a3) / 3
endop

gk_SolinaChorus_chorus_lfo1_hz init .18
gk_SolinaChorus_chorus_lfo1_amp init .6
gk_SolinaChorus_chorus_lfo2_hz init 6
gk_SolinaChorus_chorus_lfo2_amp init .2
instr SolinaChorus
aleft inleta "inleft"
aright inleta "inright"
aleft solina_chorus aleft, gk_SolinaChorus_chorus_lfo1_hz, gk_SolinaChorus_chorus_lfo1_amp, gk_SolinaChorus_chorus_lfo2_hz, gk_SolinaChorus_chorus_lfo2_amp
aright solina_chorus aright, gk_SolinaChorus_chorus_lfo1_hz, gk_SolinaChorus_chorus_lfo1_amp, gk_SolinaChorus_chorus_lfo2_hz, gk_SolinaChorus_chorus_lfo2_amp
outleta "outleft", aleft
outleta "outright", aright
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_Reverb_feedback init 0.975
gi_Reverb_delay_modulation init 0.875
gk_Reverb_frequency_cutoff init 15000
instr ReverbSC
adummy init 0
azero init 0
aleft init 0
aleft_zero init 0
aright init 0
aright_zero init 0
aleft inleta "inleft"
aright inleta "inright"
; aoutL, aoutR reverbsc ainL, ainR, kfblvl, kfco[, israte[, ipitchm[, iskip]]]
aleft, adummy  reverbsc aleft, azero,  gk_Reverb_feedback, gk_Reverb_frequency_cutoff, sr, gi_Reverb_delay_modulation
adummy, aright reverbsc azero, aright, gk_Reverb_feedback, gk_Reverb_frequency_cutoff, sr, gi_Reverb_delay_modulation
outleta "outleft", aleft
outleta "outright", aright
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

gk_MasterOutput_level init 0
instr MasterOutput
aleft inleta "inleft"
aright inleta "inright"
k_gain = ampdb(gk_MasterOutput_level)
printks2 "Master gain: %f\n", k_gain
iamp init 1
aleft butterlp aleft, 18000
aright butterlp aright, 18000
outs aleft * k_gain, aright * k_gain
prints "%24.24s i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f #%3d\n", nstrstr(p1), p1, p2, p3, p4, p5, p7, active(p1)
endin

instr Controls
    gk_BarModel_level chnget "gk_BarModel_level"
    gk_BarModel_kbcL chnget "gk_BarModel_kbcL"
    gk_BarModel_kbcR chnget "gk_BarModel_kbcR"
    gi_BarModel_iK chnget "gi_BarModel_iK"
    gi_BarModel_ib chnget "gi_BarModel_ib"
    gk_BarModel_kscan chnget "gk_BarModel_kscan"
    gi_BarModel_iT30 chnget "gi_BarModel_iT30"
    gi_BarModel_ipos chnget "gi_BarModel_ipos"
    gi_BarModel_ivel chnget "gi_BarModel_ivel" 
    gi_BarModel_iwid chnget "gi_BarModel_iwid"
    gk_Bower_attack chnget "gk_Bower_attack"
    gk_Bower_release chnget "gk_Bower_release"
    gk_Bower_level chnget "gk_Bower_level"
    gk_Bower_pressure chnget "gk_Bower_pressure"
    gk_Blower_grainDensity chnget "gk_Blower_grainDensity"
    gk_Blower_grainDuration chnget "gk_Blower_grainDuration"
    gk_Blower_grainAmplitudeRange chnget "gk_Blower_grainAmplitudeRange"
    gk_Blower_grainFrequencyRange chnget "gk_Blower_grainFrequencyRange"
    gk_Blower_level chnget "gk_Blower_level"
    gk_Buzzer_attack chnget "gk_Buzzer_attack"
    gk_Buzzer_release chnget "gk_Buzzer_release"
    gk_Buzzer_harmonics chnget "gk_Buzzer_harmonics"
    gk_Buzzer_level chnget "gk_Buzzer_level"
    gk_Droner_partial1 chnget "gk_Droner_partial1"
    gk_Droner_partial2 chnget "gk_Droner_partial2"
    gk_Droner_partial3 chnget "gk_Droner_partial3"
    gk_Droner_partial4 chnget "gk_Droner_partial4"
    gk_Droner_partial5 chnget "gk_Droner_partial5"
    gk_Droner_partial6 chnget "gk_Droner_partial6"
    gk_Droner_partial7 chnget "gk_Droner_partial7"
    gk_Droner_partial8 chnget "gk_Droner_partial8"
    gk_Droner_partial9 chnget "gk_Droner_partial9"
    gk_Droner_partial10 chnget "gk_Droner_partial10"
    gi_Droner_waveform chnget "gi_Droner_waveform"   
    gk_Droner_level chnget "gk_Droner_level"
    gk_FMModerate2_level chnget "gk_FMModerate2_level"
    gi_FMModerate2_carrier chnget "gi_FMModerate2_carrier"
    gi_FMModerate2_modulator chnget "gi_FMModerate2_modulator"
    gi_FMModerate2_fmamplitude chnget "gi_FMModerate2_fmamplitude"
    gi_FMModerate2_index chnget "gi_FMModerate2_index"
    gk_Harpsichord_level chnget "gk_Harpsichord_level"
    gk_Harpsichord_pick chnget "gk_Harpsichord_pick"
    gk_Harpsichord_reflection chnget "gk_Harpsichord_reflection"
    gk_Harpsichord_pluck chnget "gk_Harpsichord_pluck"
    gk_MasterOutput_level chnget "gk_MasterOutput_level"
    gk_Phaser_release chnget "gk_Phaser_release"
    gk_Phaser_attack chnget "gk_Phaser_attack"
    gk_Phaser_ratio1 chnget "gk_Phaser_ratio1"
    gk_Phaser_ratio2 chnget "gk_Phaser_ratio2"
    gk_Phaser_index1 chnget "gk_Phaser_index1"
    gk_Phaser_index2 chnget "gk_Phaser_index2"
    gk_Phaser_level chnget "gk_Phaser_level"
    gk_Reverb_feedback chnget "gk_Reverb_feedback"
    gi_Reverb_delay_modulation chnget "gi_Reverb_delay_modulation"
    gk_Reverb_frequency_cutoff chnget "gk_Reverb_frequency_cutoff"
    gk_Shiner_level chnget "gk_Shiner_level"
    gk_Shiner_attack chnget "gk_Shiner_attack"
    gk_Shiner_release chnget "gk_Shiner_release"
    gk_SolinaChorus_chorus_lfo1_hz init .18
    gk_SolinaChorus_chorus_lfo1_amp init .6
    gk_SolinaChorus_chorus_lfo2_hz init 6
    gk_SolinaChorus_chorus_lfo2_amp init .2
    gk_Sweeper_attack chnget "gk_Sweeper_attack"
    gk_Sweeper_release chnget "gk_Sweeper_release"
    gk_Sweeper_britel chnget "gk_Sweeper_britel"
    gk_Sweeper_briteh chnget "gk_Sweeper_briteh"
    gk_Sweeper_britels chnget "gk_Sweeper_britels"
    gk_Sweeper_britehs chnget "gk_Sweeper_britehs"
    gk_Sweeper_level chnget "gk_Sweeper_level"
    gk_YiString_reverb_send chnget "gk_YiString_reverb_send"
    gk_YiString_cbhorus_send chnget "gk_YiString_cbhorus_send"
    gk_YiString_level chnget "gk_YiString_level"
prints "Controls       i %9.4f t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\\n", p1, p2, p3, p4, p5, p7
endin

</CsInstruments>
<CsScore>
f 0 36000
</CsScore>
<CsoundSynthesizer>
    </textarea>
    <script>
        /**
         * AUTHOR: Iacopo Sassarini
         * Based on Barry Martin's formula for the hopalong fractal.
         * Updated and adapted for music generation by Michael Gogins.
         */
        // Some variables must be defined at global scope to allow for 
        // asynchronous loading of WebAssembly modules. 
        function csound_message_callback(message) {
            var messages_textarea = document.getElementById("console");
            var existing = messages_textarea.value;
            messages_textarea.value = existing + message;
            messages_textarea.scrollTop = messages_textarea.scrollHeight;
        };
        //~         var csound_message_callback = function(message_text) {
        //~             console.log(message_text);
        //~             let messages_textarea = document.getElementById("console");
        //~             let existing = messages_textarea.value;
        //~             messages_textarea.value = existing + message_text;
        //~             messages_textarea.scrollTop = messages_textarea.scrollHeight;
        //~         }
        var is_playing = false;
        var CsoundAC_;
        var chord;
        var modality;
        var FM9;
        var Bb7;
        // Load WebAssembly modules (asynchronously, yet not asynchronously).
        (async function () {
            CsoundAC_ = await createCsoundAC();
            csound_message_callback(CsoundAC_.hello());
            FM9 = CsoundAC_.chordForName('FM9');
            Bb7 = CsoundAC_.chordForName('Bb7');
            chord = Bb7.clone();
            modality = chord.clone();
        }());
        let RANGE = 60;
        let BASS = 36;
        let INSTRUMENT_COUNT = 12.99
        let NOTE_COUNT = 16;
        let container = document.getElementById('webgl_cell');
        console.log('container:' + container);
        let velocity_cutoff = 150.;
        let VISUALS_VISIBLE = true;
        let SCALE_FACTOR = 1500;
        let CAMERA_BOUND = 200;
        let NUM_POINTS_SUBSET = 40000;
        let NUM_SUBSETS = 6;
        let NUM_POINTS = NUM_POINTS_SUBSET * NUM_SUBSETS;
        let NUM_LEVELS = 5;
        let LEVEL_DEPTH = 400;
        let DEF_BRIGHTNESS = .5;
        let DEF_SATURATION = 0.8;
        let SPRITE_SIZE = Math.ceil(3 * container.clientWidth / 1600);
        // Orbit parameters constraints
        let A_MIN = -30;
        let A_MAX = 30;
        let B_MIN = .2;
        let B_MAX = 1.8;
        let C_MIN = 5;
        let C_MAX = 17;
        let D_MIN = 0;
        let D_MAX = 10;
        let E_MIN = 0;
        let E_MAX = 12;
        let note_count = 0;
        let current_time_seconds = new Date().getTime() / 1000.0;
        let start_time_seconds = current_time_seconds;
        let prior_time_seconds = current_time_seconds;
        let shuffled = false;
        let Starting_point = 0;
        let Stride = 10;//math.floor((NUM_POINTS_SUBSET / NOTE_COUNT) * NUM_SUBSETS);
        // Orbit parameters
        let a, b, c, d, e;
        // Orbit data
        let orbit = {
            subsets: [],
            xMin: 0,
            xMax: 0,
            yMin: 0,
            yMax: 0,
            scaleX: 0,
            scaleY: 0
        }
        // Initialize data points
        for (let i = 0; i < NUM_SUBSETS; i++) {
            let subsetPoints = [];
            for (let j = 0; j < NUM_POINTS_SUBSET; j++) {
                subsetPoints[j] = {
                    x: 0,
                    y: 0,
                    vertex: new THREE.Vector3(0, 0, 0)
                };
            }
            orbit.subsets.push(subsetPoints);
        }
        let camera, scene, renderer, composer, hueValues = [];
        let mouseX = 0, mouseY = 0;
        let windowHalfX = container.clientWidth / 2;
        let windowHalfY = container.clientHeight / 2;
        let Scene_speed = 2;
        let rotationSpeed = 0;
        let randomization = 0;
        let score_plane_bounding_box = null;
        init();
        animate();
        function init() {
            // Use base64 encoded image to avoid cross-domain problems.
            let galaxy = new Image();
            galaxy.src = "data:image/png;base64,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";
            sprite1 = THREE.ImageUtils.loadTexture(galaxy.src);
            camera = new THREE.PerspectiveCamera(60, 1, 1, 3 * SCALE_FACTOR);
            camera.position.z = SCALE_FACTOR / 2;
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.0012);
            generateOrbit();
            for (let s = 0; s < NUM_SUBSETS; s++) {
                hueValues[s] = Math.random();
            }
            // Create particle systems
            for (let k = 0; k < NUM_LEVELS; k++) {
                for (let s = 0; s < NUM_SUBSETS; s++) {
                    let geometry = new THREE.Geometry();
                    for (let i = 0; i < NUM_POINTS_SUBSET; i++) {
                        geometry.vertices.push(orbit.subsets[s][i].vertex);
                    }
                    let materials = new THREE.PointsMaterial({ size: (SPRITE_SIZE), map: sprite1, blending: THREE.AdditiveBlending, depthTest: false, transparent: true });
                    materials.color.setHSL(hueValues[s], DEF_SATURATION, DEF_BRIGHTNESS);
                    let particles = new THREE.Points(geometry, materials);
                    particles.myMaterial = materials;
                    particles.myLevel = k;
                    particles.mySubset = s;
                    particles.position.x = 0;
                    particles.position.y = 0;
                    particles.position.z = - LEVEL_DEPTH * k - (s * LEVEL_DEPTH / NUM_SUBSETS) + SCALE_FACTOR / 2;
                    particles.needsUpdate = 0;
                    scene.add(particles);
                }
            }
            // Setup renderer and effects.
            renderer = new THREE.WebGLRenderer({ clearColor: 0x000000, clearAlpha: 1, antialias: false });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            window.addEventListener('resize', onWindowResize, false);
            // Schedule orbit regeneration.
            setTimeout(updateOrbit, 10000 / Scene_speed);
            let milliseconds = 1000.;
            setTimeout(createNote, milliseconds);
        }
        function animate() {
            requestAnimationFrame(animate);
            render();
        }
        function render() {
            if (camera.position.x >= - CAMERA_BOUND && camera.position.x <= CAMERA_BOUND) {
                camera.position.x += (mouseX - camera.position.x) * 0.05;
                if (camera.position.x < - CAMERA_BOUND) camera.position.x = -CAMERA_BOUND;
                if (camera.position.x > CAMERA_BOUND) camera.position.x = CAMERA_BOUND;
            }
            if (camera.position.y >= - CAMERA_BOUND && camera.position.y <= CAMERA_BOUND) {
                camera.position.y += (- mouseY - camera.position.y) * 0.05;
                if (camera.position.y < - CAMERA_BOUND) camera.position.y = -CAMERA_BOUND;
                if (camera.position.y > CAMERA_BOUND) camera.position.y = CAMERA_BOUND;
            }
            camera.lookAt(scene.position);
            for (let i = 1; i < scene.children.length; i++) {
                let child = scene.children[i];
                child.position.z += Scene_speed;
                child.rotation.z += rotationSpeed * .1;
                if (child.position.z > camera.position.z) {
                    child.position.z = - (NUM_LEVELS - 1) * LEVEL_DEPTH;
                    if (child.needsUpdate == 1) {
                        child.geometry.verticesNeedUpdate = true;
                        if (typeof child.myMaterial !== 'undefined') {
                            child.myMaterial.color.setHSL(hueValues[child.mySubset], DEF_SATURATION, DEF_BRIGHTNESS);
                        }
                        child.needsUpdate = 0;
                    }
                }
            }
            renderer.render(scene, camera);
            score_time_cell = document.getElementById('Time_cell');
            current_time_seconds = new Date().getTime() / 1000.0;
            let score_time = current_time_seconds - start_time_seconds;
            score_time_cell.innerHTML = score_time.toFixed(3);
        }
        ///////////////////////////////////////////////
        // Hopalong Orbit Generator
        ///////////////////////////////////////////////
        function updateOrbit() {
            generateOrbit();
            for (let s = 0; s < NUM_SUBSETS; s++) {
                hueValues[s] = Math.random();
            }
            for (i = 0; i < scene.children.length; i++) {
                scene.children[i].needsUpdate = 1;
            }
            // Speed up or slow down the interval between generations.
            // Timeout interval is in milliseconds.
            setTimeout(updateOrbit, 10000 / Scene_speed);
        }
        function generateOrbit() {
            let x, y, z, x1;
            let idx = 0;
            prepareOrbit();
            let al = a;
            let bl = b;
            let cl = c;
            let dl = d;
            let el = e;
            let subsets = orbit.subsets;
            let num_points_subset_l = NUM_POINTS_SUBSET;
            let num_points_l = NUM_POINTS;
            let scale_factor_l = SCALE_FACTOR;
            let xMin = 0, xMax = 0, yMin = 0, yMax = 0;
            for (let s = 0; s < NUM_SUBSETS; s++) {
                // Use a different starting point for each orbit subset,
                // with a variable degree of randomization, including 0.
                x = s * .01 * (0.5 - randomization * Math.random());
                y = s * .01 * (0.5 - randomization * Math.random());
                let curSubset = subsets[s];
                for (let i = 0; i < num_points_subset_l; i++) {
                    // Iteration formula (generalization of Barry Martin's original one)
                    z = (dl + Math.sqrt(Math.abs(bl * x - cl)));
                    if (x > 0) { x1 = y - z; }
                    else if (x == 0) { x1 = y; }
                    else { x1 = y + z; }
                    y = al - x;
                    x = x1 + el;
                    curSubset[i].x = x;
                    curSubset[i].y = y;
                    if (x < xMin) { xMin = x; }
                    else if (x > xMax) { xMax = x; }
                    if (y < yMin) { yMin = y; }
                    else if (y > yMax) { yMax = y; }
                    idx++;
                }
            }
            let scaleX = 2 * scale_factor_l / (xMax - xMin);
            let scaleY = 2 * scale_factor_l / (yMax - yMin);
            orbit.xMin = xMin;
            orbit.xMax = xMax;
            orbit.yMin = yMin;
            orbit.yMax = yMax;
            orbit.scaleX = scaleX;
            orbit.scaleY = scaleY;
            for (let s = 0; s < NUM_SUBSETS; s++) {
                let curSubset = subsets[s];
                for (let i = 0; i < num_points_subset_l; i++) {
                    curSubset[i].vertex.x = scaleX * (curSubset[i].x - xMin) - scale_factor_l;
                    curSubset[i].vertex.y = scaleY * (curSubset[i].y - yMin) - scale_factor_l;
                }
            }
        }
        function prepareOrbit() {
            if (shuffled == false) {
                shuffleParams();
                shuffled = true;
            }
            orbit.xMin = 0;
            orbit.xMax = 0;
            orbit.yMin = 0;
            orbit.yMax = 0;
        }
        function shuffleParams() {
            console.log('shuffleParams()...')
            a = A_MIN + Math.random() * (A_MAX - A_MIN);
            b = B_MIN + Math.random() * (B_MAX - B_MIN);
            c = C_MIN + Math.random() * (C_MAX - C_MIN);
            d = D_MIN + Math.random() * (D_MAX - D_MIN);
            e = E_MIN + Math.random() * (E_MAX - E_MIN);
        }
        function onDocumentTouchStart(event) {
            if (event.touches.length == 1) {
                event.preventDefault();
                mouseX = event.touches[0].pageX - windowHalfX;
                mouseY = event.touches[0].pageY - windowHalfY;
            }
        }
        function onDocumentTouchMove(event) {
            if (event.touches.length == 1) {
                event.preventDefault();
                mouseX = event.touches[0].pageX - windowHalfX;
                mouseY = event.touches[0].pageY - windowHalfY;
            }
        }
        function onWindowResize(event) {
            let container = document.getElementById('webgl_cell');
            windowHalfX = container.clientWidth / 2;
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        function updateTimeCell() {
            let score_time_cell = document.getElementById('Time_cell');
            let score_time = new Date().getTime() / 1000.0;
            score_time_cell.innerHTML = score_time.toFixed(4);
            setTimeout(updateTimeCell, 100);
        };
        // Map orbit X to score instrument.
        function rescaleX(x) {
            let scale = orbit.xMax - orbit.xMin;
            x = x - orbit.xMin;
            x = x / scale;
            x = x * INSTRUMENT_COUNT;
            if (x < 1.) {
                x = 1.;
            }
            return x;
        }
        // Map orbit Y to score pitch.
        function rescaleY(x) {
            let scale = orbit.yMax - orbit.yMin;
            x = x - orbit.yMin;
            x = x / scale;
            x = x * RANGE;
            x = x + BASS;
            return x;
        }
        async function createNote() {
            let csound_ = await get_csound(csound_message_callback);
            if (is_playing !== false && csound_ != null) {
                let total_points_index = note_count * Stride;
                total_points_index = total_points_index % NUM_POINTS;
                let subset_index = Math.floor(total_points_index / NUM_POINTS_SUBSET);
                let subset_point_index = total_points_index - (subset_index * NUM_POINTS_SUBSET);
                let subset = orbit.subsets[subset_index];
                let point = subset[subset_point_index];
                let instrument = rescaleX(point.x);
                let key = rescaleY(point.y);
                let pan = Math.random();
                let event = new CsoundAC_.Event(0., parameters.Note_length, 144., instrument, key, 60., 0., pan, 0., 0., 0.);
                event.temper(12);
                CsoundAC_.conformToChord(event, chord);
                let score_text = event.toCsoundIStatement(12);
                csound_message_callback(score_text);
                csound_.ReadScore(score_text);
                let Chord_cell = document.getElementById('Chord_cell');
                Chord_cell.innerHTML = chord.name();
                let Notes_cell = document.getElementById('Notes_cell');
                Notes_cell.innerHTML = note_count;
                let Subset_cell = document.getElementById('Subset_cell');
                Subset_cell.innerHTML = subset_index;
                let Point_cell = document.getElementById('Point_cell');
                Point_cell.innerHTML = subset_point_index;
                let X_cell = document.getElementById('X_cell');
                X_cell.innerHTML = sprintf("%011.4f", point.x);
                let Y_cell = document.getElementById('Y_cell');
                Y_cell.innerHTML = sprintf("%011.4f", point.y);
                note_count = note_count + 1;
            }
            setTimeout(createNote, 1000. / parameters.Notes_per_second);
        }
        // If you want to persist the values of these parameters more reliably
        // than by means of local storage, copy the values from the nw.gui preset dialog
        // and paste the values over these.
        let parameters = {
            "gk_BarModel_kbcL": 1,
            "gk_BarModel_kbcR": 1,
            "gi_BarModel_iK": 0,
            "gi_BarModel_ib": .001,
            "gk_BarModel_kscan": .23,
            "gi_BarModel_iT30": 5,
            "gi_BarModel_ipos": 0.3,
            "gi_BarModel_ivel": 1000,
            "gi_BarModel_iwid": 0.05,
            "gk_BarModel_level": 0,
            "gk_Blower_grainDensity": 0.15,
            "gk_Blower_grainDuration": 0.2,
            "gk_Blower_grainAmplitudeRange": 0.1,
            "gk_Blower_grainFrequencyRange": 0.033,
            "gk_Blower_level": 0,
            "gk_Bower_attack": 0.0125,
            "gk_Bower_release": 0.25,
            "gk_Bower_pressure": 0.25,
            "gk_Bower_level": 0,
            "gk_Buzzer_attack": .125,
            "gk_Buzzer_release": .25,
            "gk_Buzzer_harmonics": 15,
            "gk_Buzzer_level": 0,
            "gk_Droner_partial1": 0.1,
            "gk_Droner_partial2": 0.1,
            "gk_Droner_partial3": 0.1,
            "gk_Droner_partial4": 0.1,
            "gk_Droner_partial5": 0.1,
            "gk_Droner_partial6": 0.1,
            "gk_Droner_partial7": 0.1,
            "gk_Droner_partial8": 0.1,
            "gk_Droner_partial9": 0.1,
            "gk_Droner_partial10": 0.1,
            "gk_Droner_waveform": 0,
            "gk_Droner_level": 0,
            "gi_FMModerate2_index": 2,
            "gi_FMModerate2_carrier": 1,
            "gi_FMModerate2_modulator": 4,
            "gi_FMModerate2_fmamplitude": 9,
            "gk_FMModerate2_level": 0,
            "gk_Harpsichord_level": 0,
            "gk_MasterOutput_level": 15.906627761567321,
            "gk_Phaser_attack": .125,
            "gk_Phaser_release": .125,
            "gk_Phaser_ratio1": 1,
            "gk_Phaser_ratio2": 0.3333334,
            "gk_Phaser_index1": 1,
            "gk_Phaser_index2": 0.0125,
            "gk_Phaser_level": 0,
            "gk_Rhodes_level": 0,
            "gk_Reverb_feedback": 0.75,
            "gi_Reverb_delay_modulation": 0.27761567319716546,
            "gk_Reverb_frequency_cutoff": 15000,
            "gk_Sweeper_attack": .125,
            "gk_Sweeper_release": .25,
            "gk_Sweeper_britel": 0,
            "gk_Sweeper_briteh": 2.9,
            "gk_Sweeper_britels": 0.06666666666666667,
            "gk_Sweeper_britehs": 1.25,
            "gk_Sweeper_level": 0,
            "gk_Xing_level": 0,
            "gk_YiString_reverb_send": 1,
            "gk_YiString_chorus_send": 0,
            "gk_YiString_level": 0,
            "gk_Shiner_attack": .0125,
            "gk_Shiner_release": .0125,
            "gk_Shiner_level": 0,
            "A": 1,
            "B": 1.8,
            "C": 5,
            "D": 3,
            "E": 5,
            "Scene_speed": 1,
            "Scene_randomization": 1,
            "Starting_point": 0,
            "Stride": 100,
            "Note_length": 1,
            "Notes_per_second": 8,
            "Camera_X": 0,
            "Camera_Y": 0,
            Starting_point: 0,
            Note_length: 1.,
            Notes_per_second: 8.,
            Stride: 100,
            Play: function () {
                (async () => {
                    let csound_ = await get_csound(csound_message_callback);
                    if (csound_ == null) {
                        return;
                    }
                    let result = await csound_.CompileCsdText(document.getElementById('csd').value);
                    csound_message_callback("CompileCsdText returned: " + result);
                    await csound_.Start();
                    is_playing = true;
                    gui.revert();
                    start_time_seconds = new Date().getTime() / 1000.0;
                    await csound_.Perform();
                    setTimeout(updateTimeCell, 0);
                })();
            },
            Stop: function () {
                (async () => {
                    let csound_ = await get_csound(csound_message_callback);
                    is_playing = false;
                    await csound_.Stop();
                    await csound_.Cleanup();
                    await csound_.Reset();
                })();
            },
            Close: async function () {
                try {
                    let csound_ = await get_csound(csound_message_callback);
                    is_playing = false;
                    await csound_.Stop();
                    await csound_.Cleanup();
                    await csound_.Reset();
                } catch (e) {
                    console.log(e);
                }
            },
            FM9: function () {
                chord = FM9.clone();
                csound_message_callback('FM9:\n' + chord.information());
            },
            Bb7: function () {
                chord = Bb7.clone();
                csound_message_callback('Bb7:\n' + chord.information());
            },
            K: function () {
                chord = chord.K();
                csound_message_callback('K():\n' + chord.information());
            },
            T2: function () {
                chord = chord.T(2, 1);
                csound_message_callback('T(2):\n' + chord.information());
            },
            Q2: function () {
                chord = chord.Q(2, modality, 1);
                csound_message_callback('Q(2, modality):\n' + chord.information());
            },
            Q3: function () {
                chord = chord.Q(3, modality, 1);
                csound_message_callback('Q(3, modality):\n' + chord.information());
            },
            Q5: function () {
                chord = chord.Q(5, modality, 1);
                csound_message_callback('Q(5, modality):\n' + chord.information());
            },
            T5: function () {
                chord = chord.T(5, 1);
                csound_message_callback('D():\n' + chord.information());
            },
        };
        let gui = null;
        let a_slider = null;
        let b_slider = null;
        let c_slider = null;
        let d_slider = null;
        let e_slider = null;
        window.onload = function () {
            gui = new dat.GUI({ width: 300 });
            gui.remember(parameters);
            gui.add(parameters, 'Play').name('Play [P]');
            gui.add(parameters, 'Stop').name('Stop [S]');
            let Master = gui.addFolder('Master effects');
            add_slider(Master, 'gk_Reverb_feedback', 0, 1);
            add_slider(Master, 'gi_Reverb_delay_modulation', 0, 3);
            add_slider(Master, 'gk_Reverb_frequency_cutoff', 5000, 20000);
            add_slider(Master, 'gk_MasterOutput_level', -80, 80);
            let instruments = gui.addFolder('Instruments');
            //let BarModel = instruments.addFolder('BarModel');
            //add_slider(BarModel, 'gk_BarModel_kbcL', 1, 3);
            //add_slider(BarModel, 'gk_BarModel_kbcR', 1, 3);
            //add_slider(BarModel, 'gi_BarModel_iK', -5, 5);
            //add_slider(BarModel, 'gi_BarModel_ib', 0, 1);
            //add_slider(BarModel, 'gk_BarModel_kscan', 0, 2);
            //add_slider(BarModel, 'gi_BarModel_iT30', 0, 20);
            //add_slider(BarModel, 'gi_BarModel_ipos', 0, 1);
            //add_slider(BarModel, 'gi_BarModel_ivel', 0, 10000);
            //add_slider(BarModel, 'gi_BarModel_iwid', 0, 1);           
            //add_slider(BarModel, 'gk_BarModel_level', -80, 80);
            let Blower = instruments.addFolder('Blower');
            add_slider(Blower, 'gk_Blower_grainDensity', 0, 400);
            add_slider(Blower, 'gk_Blower_grainDuration', 0, .5);
            add_slider(Blower, 'gk_Blower_grainAmplitudeRange', 0, 400);
            add_slider(Blower, 'gk_Blower_grainFrequencyRange', 0, 100);
            add_slider(Blower, 'gk_Blower_level', -80, 80);
            let Bower = instruments.addFolder('Bower');
            add_slider(Bower, 'gk_Bower_attack', 0, .25);
            add_slider(Bower, 'gk_Bower_release', 0, .5);
            add_slider(Bower, 'gk_Bower_pressure', 0, 1);
            add_slider(Bower, 'gk_Bower_level', -80, 80);
            let Buzzer = instruments.addFolder('Buzzer');
            add_slider(Buzzer, 'gk_Buzzer_attack', 0, .25);
            add_slider(Buzzer, 'gk_Buzzer_release', 0, .5);
            add_slider(Buzzer, 'gk_Buzzer_harmonics', 0, 20);
            add_slider(Buzzer, 'gk_Buzzer_level', -80, 80);
            let Droner = instruments.addFolder('Droner');
            add_slider(Droner, 'gk_Droner_partial1', 0, 1);
            add_slider(Droner, 'gk_Droner_partial2', 0, 1);
            add_slider(Droner, 'gk_Droner_partial3', 0, 1);
            add_slider(Droner, 'gk_Droner_partial4', 0, 1);
            add_slider(Droner, 'gk_Droner_partial5', 0, 1);
            add_slider(Droner, 'gk_Droner_partial6', 0, 1);
            add_slider(Droner, 'gk_Droner_partial7', 0, 1);
            add_slider(Droner, 'gk_Droner_partial8', 0, 1);
            add_slider(Droner, 'gk_Droner_partial9', 0, 1);
            add_slider(Droner, 'gk_Droner_partial10', 0, 1);
            add_slider(Droner, 'gk_Droner_waveform', 0, 1);
            add_slider(Droner, 'gk_Droner_level', -80, 80);
            let FMModerate2 = instruments.addFolder('FMModerate2');
            add_slider(FMModerate2, 'gi_FMModerate2_carrier', .1, 10);
            add_slider(FMModerate2, 'gi_FMModerate2_modulator', .1, 10);
            add_slider(FMModerate2, 'gi_FMModerate2_fmamplitude', 1, 10);
            add_slider(FMModerate2, 'gi_FMModerate2_index', 1, 20);
            add_slider(FMModerate2, 'gk_FMModerate2_level', -80, 80);
            let Harpsichord = instruments.addFolder('Harpsichord');
            add_slider(Harpsichord, 'gk_Harpsichord_level', -80, 80);
            let Rhodes = instruments.addFolder('Rhodes');
            add_slider(Rhodes, 'gk_Rhodes_level', -80, 80);
            let Phaser = instruments.addFolder('Phaser');
            add_slider(Phaser, 'gk_Phaser_attack', 0, .25);
            add_slider(Phaser, 'gk_Phaser_release', 0, .5);
            add_slider(Phaser, 'gk_Phaser_ratio1', 0, 2);
            add_slider(Phaser, 'gk_Phaser_ratio2', 0, 2);
            add_slider(Phaser, 'gk_Phaser_index1', 0, 1);
            add_slider(Phaser, 'gk_Phaser_index2', 0, 1);
            add_slider(Phaser, 'gk_Phaser_level', -80, 80);
            let Shiner = instruments.addFolder('Shiner');
            add_slider(Shiner, 'gk_Shiner_level', -80, 80);
            let Sweeper = instruments.addFolder('Sweeper');
            add_slider(Sweeper, 'gk_Sweeper_attack', 0, .5);
            add_slider(Sweeper, 'gk_Sweeper_release', 0, .25);
            add_slider(Sweeper, 'gk_Sweeper_britel', 0, 4);
            add_slider(Sweeper, 'gk_Sweeper_briteh', 0, 4);
            add_slider(Sweeper, 'gk_Sweeper_britels', 0, 4);
            add_slider(Sweeper, 'gk_Sweeper_britehs', 0, 4);
            add_slider(Sweeper, 'gk_Sweeper_level', -80, 80);
            let Xing = instruments.addFolder('Xing');
            add_slider(Xing, 'gk_Xing_level', -80, 80);
            let YiString = instruments.addFolder('YiString');
            add_slider(YiString, 'gk_YiString_reverb_send', 0, 1);
            add_slider(YiString, 'gk_YiString_chorus_send', 0, 1);
            add_slider(YiString, 'gk_YiString_level', -80, 80);
            let Hopalong = gui.addFolder('Hopalong fractal');
            a_slider = add_slider(Hopalong, 'A', -30, 30).name('E [A]');
            b_slider = add_slider(Hopalong, 'B', .2, 1.8).name('B [B]');
            c_slider = add_slider(Hopalong, 'C', 5, 17).name('C [C]');
            d_slider = add_slider(Hopalong, 'D', 0, 10).name('D [D]');
            e_slider = add_slider(Hopalong, 'E', 5, 12).name('E [E]');
            let Chords = gui.addFolder('Chords and transformations')
            Chords.add(parameters, 'Bb7');
            Chords.add(parameters, 'FM9');
            Chords.add(parameters, 'K').name('K() [K]');
            Chords.add(parameters, 'Q2').name('Q(2)');
            Chords.add(parameters, 'Q3').name('Q(3) [Q]');
            Chords.add(parameters, 'Q5').name('Q(5)');
            Chords.add(parameters, 'T5').name('D() [5]');
            let Generate = gui.addFolder('Note generation')
            add_slider(Generate, 'Scene_speed', .5, 20).name('Scene speed');
            add_slider(Generate, 'Scene_randomization', 0, 1).name('Scene randomization');
            add_slider(Generate, 'Starting_point', 0, 39999).name('Starting index');
            add_slider(Generate, 'Stride', 1, 40000);
            add_slider(Generate, 'Note_length', 0.125, 8).name('Note duration');
            add_slider(Generate, 'Notes_per_second', 0.25, 100).name('Notes per second');
            add_slider(Generate, 'Camera_X', -500, 500).name('Camera X');
            add_slider(Generate, 'Camera_Y', -500, 500).name('Camera Y');
            gui.revert();
        }
        async function update_channel(name, value) {
            if (is_playing === true) {
                let numberValue = parseFloat(value);
                let csound_ = await get_csound(csound_message_callback);
                csound_.SetControlChannel(name, numberValue);
                csound_message_callback(name + ': ' + numberValue + '\n');
            }
        }
        function add_slider(gui_folder, token, minimum, maximum) {
            let on_parameter_change = function (value) {
                if (token.startsWith('gk_') || token.startsWith('gi_')) {
                    update_channel(token, value);
                } else if (token === 'Scene_speed') {
                    Scene_speed = value;
                } else if (token === 'Scene_randomization') {
                    randomization = value;
                } else if (token === 'Camera_X') {
                    mouseX = value;
                } else if (token === 'Camera_Y') {
                    mouseY = value;
                } else if (token === 'A') {
                    a = value;
                } else if (token === 'B') {
                    b = value;
                } else if (token === 'C') {
                    c = value;
                } else if (token === 'D') {
                    d = value;
                } else if (token === 'E') {
                    e = value;
                } else if (token === 'Starting_point') {
                    Starting_point = Math.floor(value);
                } else if (token === 'Stride') {
                    Stride = Math.floor(value);
                }
            };
            let slider = gui_folder.add(parameters, token, minimum, maximum);
            slider.onChange(on_parameter_change);
            return slider;
        };
        // Used to find out what actually happens when a key is pressed.
        function printKey(e) {
            e = e || event
            //if (document.forms.keyform[e.type + 'Ignore'].checked) return
            let evt = e.type
            while (evt.length < 10) evt += ' ';
            let data = evt +
                ' keyCode=' + e.keyCode +
                ' which=' + e.which +
                ' charCode=' + e.charCode +
                ' char=' + String.fromCharCode(e.keyCode || e.charCode) +
                (e.shiftKey ? ' +shift' : '') +
                (e.ctrlKey ? ' +ctrl' : '') +
                (e.altKey ? ' +alt' : '') +
                (e.metaKey ? ' +meta' : '') + '\n';
            let message = { data: data };
            //if (document.forms.keyform[e.type + 'Stop'].checked) {
            //  e.preventDefault ? e.preventDefault() : (e.returnValue = false)
            //}
            csound_message_callback(message);
        }
        // The 'keydown' event is used for key bindings.
        $(document).on("keydown", function (e) {
            //printKey(e);
            let e_char = String.fromCharCode(e.keyCode || e.charCode);
            let sign = -1;
            if (e.shiftKey === true) {
                sign = 1;
            }
            if (e_char === 'H') {
                $("#statistics").toggle();
                gui.toggle();
            } else if (e_char === 'K') {
                parameters.K();
            } else if (e_char === 'Q') {
                parameters.Q3();
            } else if (e_char === '5') {
                parameters.T5();
            } else if (e_char === '2') {
                parameters.T2();
            } else if (e_char === 'P') {
                parameters.Play();
            } else if (e_char === 'S') {
                parameters.Stop();
            } else if (e_char === 'A') {
                parameters.A += a_slider.__impliedStep * sign;
                a_slider.updateDisplay();
            } else if (e_char === 'B') {
                parameters.B += b_slider.__impliedStep * sign;
                b_slider.updateDisplay();
            } else if (e_char === 'C') {
                parameters.C += c_slider.__impliedStep * sign;
                c_slider.updateDisplay();
            } else if (e_char === 'D') {
                parameters.D += d_slider.__impliedStep * sign;
                d_slider.updateDisplay();
            } else if (e_char === 'E') {
                parameters.E += e_slider.__impliedStep * sign;
                e_slider.updateDisplay();
            }
        });
    </script>
</body>

</html>